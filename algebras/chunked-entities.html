<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="manual">
<meta name="generator" content="Paradox, paradox-material-theme=0.6.0, mkdocs-material=3.0.3">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.language" content="">
<meta name="lang:search.pipeline.stopwords" content="true">
<meta name="lang:search.pipeline.trimmer" content="true">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="manual">
<link rel="shortcut icon" href="../assets/images/favicon.png">
<title>Chunked Entities · endpoints4s</title>
<link rel="stylesheet" href="../assets/stylesheets/application.451f80e5.css">
<link rel="stylesheet" href="../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../lib/prettify/prettify.css">
<script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="../assets/fonts/font-awesome.css">
<link rel="stylesheet" href="../assets/fonts/material-icons.css">
<link rel="stylesheet" href="../assets/stylesheets/paradox-material-theme.css">
<link rel="stylesheet" href="../snippets.css">
</head>
<body
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../index.html" title="endpoints4s" class="md-header-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
endpoints4s
</span>
<span class="md-header-nav__topic">
Chunked Entities
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
<label class="md-icon md-search__icon" for="__search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
<div class="md-flex__cell md-flex__cell--shrink">
<div class="md-header-nav__source">
<a href="https://github.com/endpoints4s/endpoints4s"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
endpoints4s/endpoints4s
</div>
</a>

</div>
</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<a href="../index.html" title="endpoints4s" class="md-nav__button md-logo">
<span class="md-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
<a href="../index.html" title="endpoints4s">
endpoints4s
</a>
</label>
<div class="md-nav__source">
<a href="https://github.com/endpoints4s/endpoints4s"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
endpoints4s/endpoints4s
</div>
</a>

</div>
<ul>
  <li><a href="../use-cases.html" class="page">Use Cases</a></li>
  <li><a href="../quick-start.html" class="page">Quick start</a></li>
  <li><a href="../design.html" class="page">Design in a nutshell</a></li>
  <li><a href="../algebras-and-interpreters.html" class="page">Algebras and interpreters</a>
  <ul>
    <li><a href="../algebras/endpoints.html" class="page"><code>Endpoints</code></a></li>
    <li><a href="../algebras/json-entities.html" class="page">JSON Entities</a></li>
    <li><a href="../algebras/json-schemas.html" class="page">JSON Schemas</a></li>
    <li><a href="../algebras/chunked-entities.html" class="active page">Chunked Entities</a></li>
    <li><a href="../algebras/middlewares.html" class="page">Middlewares</a></li>
    <li><a href="../algebras/assets.html" class="page">Assets</a></li>
    <li><a href="../algebras/mux-endpoints.html" class="page">Multiplexed Endpoints</a></li>
    <li><a href="../interpreters/pekko-http.html" class="page">Pekko HTTP</a></li>
    <li><a href="../interpreters/http4s.html" class="page">http4s</a></li>
    <li><a href="../interpreters/scalajs-web-fetch.html" class="page">Scala.js web client (Fetch)</a></li>
    <li><a href="../interpreters/sttp.html" class="page">sttp</a></li>
    <li><a href="../interpreters/openapi.html" class="page">OpenAPI</a></li>
    <li><a href="../interpreters/circe.html" class="page">Circe</a></li>
    <li><a href="../interpreters/play-json.html" class="page">Play JSON</a></li>
  </ul></li>
  <li><a href="../guides.html" class="page">Guides</a>
  <ul>
    <li><a href="../guides/tupler.html" class="page"><code>Tupler</code></a></li>
    <li><a href="../guides/custom-authentication.html" class="page">Application-specific authentication</a></li>
  </ul></li>
  <li><a href="../community.html" class="page">Community</a></li>
  <li><a href="../comparison.html" class="page">Comparison with similar tools</a></li>
  <li><a href="../talks.html" class="page">Talks and Articles</a></li>
  <li><a href="../release-and-compatibility-notes.html" class="page">Release and Compatibility Notes</a></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../algebras/chunked-entities.html#chunked-entities" class="header">Chunked Entities</a>
  <ul>
    <li><a href="../algebras/chunked-entities.html#chunkedentities" class="header"><code>ChunkedEntities</code></a></li>
    <li><a href="../algebras/chunked-entities.html#chunkedjsonentities" class="header"><code>ChunkedJsonEntities</code></a></li>
    <li><a href="../algebras/chunked-entities.html#custom-serialization-format" class="header">Custom Serialization Format</a></li>
  </ul></li>
</ul>
</nav>

</nav>
<ul style="display: none">
<li class="md-nav__item md-version" id="project.version">
<label class="md-nav__link" for="__version">
<i class="md-icon" title="Version">label_outline</i> 1.12.0
</label>
</li>
</ul>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../algebras/chunked-entities.html#chunked-entities" class="header">Chunked Entities</a>
  <ul>
    <li><a href="../algebras/chunked-entities.html#chunkedentities" class="header"><code>ChunkedEntities</code></a></li>
    <li><a href="../algebras/chunked-entities.html#chunkedjsonentities" class="header"><code>ChunkedJsonEntities</code></a></li>
    <li><a href="../algebras/chunked-entities.html#custom-serialization-format" class="header">Custom Serialization Format</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#chunked-entities" name="chunked-entities" class="anchor"><span class="anchor-link"></span></a>Chunked Entities</h1>
<h2><a href="#chunkedentities" name="chunkedentities" class="anchor"><span class="anchor-link"></span></a><code>ChunkedEntities</code></h2>
<p>This algebra provides vocabulary to describe endpoints whose requests or responses are streamed using the “chunked transfer-encoding” supported by HTTP1.1.</p>
<p><a href="https://index.scala-lang.org/endpoints4s/endpoints4s/algebra" title="Artifact algebra"><img src="https://img.shields.io/maven-central/v/org.endpoints4s/algebra_2.13?label=algebra&style=for-the-badge" title="Artifact coordinates" /></a></p>
<p><a href="../api/endpoints4s/algebra/ChunkedEntities.html" title="endpoints4s.algebra.ChunkedEntities"><code>API documentation</code></a></p>
<p>The <code>ChunkedEntities</code> module enriches the <code>Endpoints</code> algebra with operations for defining request and responses entities carrying stream of values.</p>
<p>For instance, you can define an endpoint streaming a binary file as follows:</p>
<pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/endpoints4s/endpoints4s/tree/master/algebras/algebra/src/test/scala/endpoints4s/algebra/ChunkedEntitiesDocs.scala#L6-L7" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val logo: Endpoint[Unit, Chunks[Array[Byte]]] =
  endpoint(get(path / &quot;logo.png&quot;), ok(bytesChunksResponse))</code></pre>
<p>The return type, <code>Endpoint[Unit, Chunks[Array[Byte]]]</code>, represents an endpoint whose request takes no parameter (<code>Unit</code>) and whose response produces a stream of <code>Array[Byte]</code> chunks.</p>
<p>Responses are streamed using the <a href="https://en.wikipedia.org/wiki/Chunked_transfer_encoding">chunked transfer-encoding</a>, which is supported by most HTTP 1.1 clients and servers.</p>
<h2><a href="#chunkedjsonentities" name="chunkedjsonentities" class="anchor"><span class="anchor-link"></span></a><code>ChunkedJsonEntities</code></h2>
<p><a href="https://index.scala-lang.org/endpoints4s/endpoints4s/algebra" title="Artifact algebra"><img src="https://img.shields.io/maven-central/v/org.endpoints4s/algebra_2.13?label=algebra&style=for-the-badge" title="Artifact coordinates" /></a></p>
<p><a href="../api/endpoints4s/algebra/ChunkedJsonEntities.html" title="endpoints4s.algebra.ChunkedJsonEntities"><code>API documentation</code></a></p>
<p>Clients and servers have to agree on the serialization format used by response chunks and WebSocket messages. The <code>ChunkedJsonEntities</code> module provides a <code>jsonChunksRequest</code> constructor and a <code>jsonChunksResponse</code> constructor for defining request entities and response entities carrying streams of values that are serialized into JSON. In addition, entity constructors must also be provided with an implementation of chunk framing, which is defined by the <code>Framing</code> module. This is required to compensate for the fact that the chunks of “chunked transfer-encoding” can be re-framed during transport, and thus cannot solely be relied on as a method of framing. The library provides the constructor for <code>newLineDelimiterFraming</code>, which delimits each frame by a new-line character:</p>
<pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/endpoints4s/endpoints4s/tree/master/algebras/algebra/src/test/scala/endpoints4s/algebra/ChunkedEntitiesDocs.scala#L13-L21" target="_blank" title="Go to snippet source">source</a><code class="language-scala">trait JsonStreamingExample
    extends endpoints4s.algebra.Endpoints
    with endpoints4s.algebra.ChunkedJsonEntities
    with endpoints4s.algebra.JsonEntitiesFromSchemas {

  val ticks =
    endpoint(get(path / &quot;ticks&quot;), ok(jsonChunksResponse[Unit](newLineDelimiterFraming)))

}</code></pre>
<p>This example uses the <code>JsonEntitiesFromSchemas</code> algebra to derive the JSON serialization format from a JSON schema, which can also be reused by the OpenAPI interpreter.</p>
<p>Eventually, mix a <code>JsonEntitiesFromSchemas</code> interpreter of your choice to turn the JSON schemas into proper JSON codecs. For instance, for Pekko-Http:</p>
<pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/endpoints4s/endpoints4s/tree/master/pekko-http/server/src/test/scala/endpoints4s/pekkohttp/server/ChunkedEntitiesDocs.scala#L38-L50" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import org.apache.pekko.stream.scaladsl.Source
import endpoints4s.pekkohttp.server

object JsonStreamingExampleServer
    extends JsonStreamingExample
    with server.Endpoints
    with server.ChunkedJsonEntities
    with server.JsonEntitiesFromSchemas {

  val routes =
    ticks.implementedBy(_ =&gt; Source.tick(0.seconds, 1.second, ()))

}</code></pre>
<h2><a href="#custom-serialization-format" name="custom-serialization-format" class="anchor"><span class="anchor-link"></span></a>Custom Serialization Format</h2>
<p>Support for other serialization formats can be added by defining an operation returning a <code>Chunks[A]</code> value. For instance, the <a href="https://developers.google.com/protocol-buffers">Protocol Buffers</a> format would be supported as follows (using <a href="https://julien-lafont.github.io/protoless/">protoless</a>):</p>
<pre class="prettyprint"><code class="language-scala">import endpoints4s.algebra
import io.protoless.messages.{Decoder, Encoder}

trait ProtobufChunkedEntities extends algebra.ChunkedEntities {
  /** Streams containing values of type `A`, serialized with the given protobuf codec */
  def protobufChunksRequest[A : Encoder : Decoder]: RequestEntity[Chunks[A]]
}
</code></pre>
<p>And then, the <code>protobufChunksRequest</code> operation would have to be implemented on each interpreter.</p>
</div>
<div>
<a href="https://github.com/endpoints4s/endpoints4s/tree/master/documentation/manual/src/main/paradox/algebras/chunked-entities.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
1.12.0
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../algebras/json-schemas.html" title="JSON Schemas" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
JSON Schemas
</span>
</div>
</a>
<a href="../algebras/middlewares.html" title="Middlewares" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Middlewares
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
<div class="md-footer-social">
<a href="https://github.com/endpoints4s/endpoints4s" class="md-footer-social__link fa fa-github"></a>
</div>

</div>
</div>
</footer>

</div>
<script src="../assets/javascripts/application.583bbe55.js"></script>
<script src="../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../."}})</script>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
</body>
</html>

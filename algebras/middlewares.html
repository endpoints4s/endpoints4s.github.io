<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="manual">
<meta name="generator" content="Paradox, paradox-material-theme=0.6.0, mkdocs-material=3.0.3">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.language" content="">
<meta name="lang:search.pipeline.stopwords" content="true">
<meta name="lang:search.pipeline.trimmer" content="true">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="manual">
<link rel="shortcut icon" href="../assets/images/favicon.png">
<title>Middlewares · endpoints4s</title>
<link rel="stylesheet" href="../assets/stylesheets/application.451f80e5.css">
<link rel="stylesheet" href="../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../lib/prettify/prettify.css">
<script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="../assets/fonts/font-awesome.css">
<link rel="stylesheet" href="../assets/fonts/material-icons.css">
<link rel="stylesheet" href="../assets/stylesheets/paradox-material-theme.css">
<link rel="stylesheet" href="../snippets.css">
</head>
<body
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../index.html" title="endpoints4s" class="md-header-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
endpoints4s
</span>
<span class="md-header-nav__topic">
Middlewares
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
<label class="md-icon md-search__icon" for="__search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
<div class="md-flex__cell md-flex__cell--shrink">
<div class="md-header-nav__source">
<a href="https://github.com/endpoints4s/endpoints4s"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
endpoints4s/endpoints4s
</div>
</a>

</div>
</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<a href="../index.html" title="endpoints4s" class="md-nav__button md-logo">
<span class="md-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
<a href="../index.html" title="endpoints4s">
endpoints4s
</a>
</label>
<div class="md-nav__source">
<a href="https://github.com/endpoints4s/endpoints4s"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
endpoints4s/endpoints4s
</div>
</a>

</div>
<ul>
  <li><a href="../use-cases.html" class="page">Use Cases</a></li>
  <li><a href="../quick-start.html" class="page">Quick start</a></li>
  <li><a href="../design.html" class="page">Design in a nutshell</a></li>
  <li><a href="../algebras-and-interpreters.html" class="page">Algebras and interpreters</a>
  <ul>
    <li><a href="../algebras/endpoints.html" class="page"><code>Endpoints</code></a></li>
    <li><a href="../algebras/json-entities.html" class="page">JSON Entities</a></li>
    <li><a href="../algebras/json-schemas.html" class="page">JSON Schemas</a></li>
    <li><a href="../algebras/chunked-entities.html" class="page">Chunked Entities</a></li>
    <li><a href="../algebras/middlewares.html" class="active page">Middlewares</a></li>
    <li><a href="../algebras/assets.html" class="page">Assets</a></li>
    <li><a href="../algebras/mux-endpoints.html" class="page">Multiplexed Endpoints</a></li>
    <li><a href="../interpreters/pekko-http.html" class="page">Pekko HTTP</a></li>
    <li><a href="../interpreters/http4s.html" class="page">http4s</a></li>
    <li><a href="../interpreters/scalajs-web-fetch.html" class="page">Scala.js web client (Fetch)</a></li>
    <li><a href="../interpreters/sttp.html" class="page">sttp</a></li>
    <li><a href="../interpreters/openapi.html" class="page">OpenAPI</a></li>
    <li><a href="../interpreters/circe.html" class="page">Circe</a></li>
    <li><a href="../interpreters/play-json.html" class="page">Play JSON</a></li>
  </ul></li>
  <li><a href="../guides.html" class="page">Guides</a>
  <ul>
    <li><a href="../guides/tupler.html" class="page"><code>Tupler</code></a></li>
    <li><a href="../guides/custom-authentication.html" class="page">Application-specific authentication</a></li>
  </ul></li>
  <li><a href="../community.html" class="page">Community</a></li>
  <li><a href="../comparison.html" class="page">Comparison with similar tools</a></li>
  <li><a href="../talks.html" class="page">Talks and Articles</a></li>
  <li><a href="../release-and-compatibility-notes.html" class="page">Release and Compatibility Notes</a></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../algebras/middlewares.html#middlewares" class="header">Middlewares</a>
  <ul>
    <li><a href="../algebras/middlewares.html#overview" class="header">Overview</a></li>
    <li><a href="../algebras/middlewares.html#transforming-requests" class="header">Transforming Requests</a></li>
    <li><a href="../algebras/middlewares.html#transforming-responses" class="header">Transforming Responses</a></li>
    <li><a href="../algebras/middlewares.html#transforming-endpoints" class="header">Transforming Endpoints</a></li>
  </ul></li>
</ul>
</nav>

</nav>
<ul style="display: none">
<li class="md-nav__item md-version" id="project.version">
<label class="md-nav__link" for="__version">
<i class="md-icon" title="Version">label_outline</i> 1.12.1
</label>
</li>
</ul>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../algebras/middlewares.html#middlewares" class="header">Middlewares</a>
  <ul>
    <li><a href="../algebras/middlewares.html#overview" class="header">Overview</a></li>
    <li><a href="../algebras/middlewares.html#transforming-requests" class="header">Transforming Requests</a></li>
    <li><a href="../algebras/middlewares.html#transforming-responses" class="header">Transforming Responses</a></li>
    <li><a href="../algebras/middlewares.html#transforming-endpoints" class="header">Transforming Endpoints</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#middlewares" name="middlewares" class="anchor"><span class="anchor-link"></span></a>Middlewares</h1>
<p>The <a href="endpoints.html"><code>Endpoints</code></a> algebra provides operations for transforming endpoint descriptions to enrich their request, their response, or their documentation. These transformation operations are documented here.</p>
<p><a href="https://index.scala-lang.org/endpoints4s/endpoints4s/algebra" title="Artifact algebra"><img src="https://img.shields.io/maven-central/v/org.endpoints4s/algebra_2.13?label=algebra&style=for-the-badge" title="Artifact coordinates" /></a></p>
<p><a href="../api/endpoints4s/algebra/Endpoints.html" title="endpoints4s.algebra.Endpoints"><code>API documentation</code></a></p>
<h2><a href="#overview" name="overview" class="anchor"><span class="anchor-link"></span></a>Overview</h2>
<p>Middlewares allow you to define reusable transformations of endpoint requests, responses, or documentation. These transformations are reusable because they can be applied to arbitrary endpoint descriptions. Let’s look at an example.</p>
<p>Consider a service that requires all the requests to provide a custom header named <code>X-API-Key</code>. The endpoints of such a service could be defined as follows:</p>
<pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/endpoints4s/endpoints4s/tree/master/algebras/algebra/src/test/scala/endpoints4s/algebra/EndpointsDocs.scala#L102-L112" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val xApiKeyHeader = requestHeader(&quot;X-API-Key&quot;, Some(&quot;API Key&quot;))

val foo = endpoint(
  get(path / &quot;foo&quot;, headers = xApiKeyHeader),
  ok(textResponse)
)

val bar = endpoint(
  get(path / &quot;bar&quot;, headers = xApiKeyHeader),
  ok(textResponse)
)</code></pre>
<p>We first define the description of the request header in a value <code>xApiKeyHeader</code>, which we add to every endpoint definition. It is nice to be able to just reuse the <code>xApiKeyHeader</code> value everywhere, but if at some point we wanted to change the way the service supports authentication &mdash; e.g., by using a query parameter instead of a header, we would have to update all the request definitions accordingly.</p>
<p>Alternatively, enriching a request definition with the fact that it also carries an API key could be defined as a reusable transformation:</p>
<pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/endpoints4s/endpoints4s/tree/master/algebras/algebra/src/test/scala/endpoints4s/algebra/EndpointsDocs.scala#L118-L129" target="_blank" title="Go to snippet source">source</a><code class="language-scala">def withApiKey[A](request: Request[A]): Request[(A, String)] =
  request.addHeaders(requestHeader(&quot;X-API-Key&quot;, Some(&quot;API Key&quot;)))

val foo = endpoint(
  withApiKey(get(path / &quot;foo&quot;)),
  ok(textResponse)
)

val bar = endpoint(
  withApiKey(get(path / &quot;bar&quot;)),
  ok(textResponse)
)</code></pre>
<p>The method <code>withApiKey</code> takes a request description and enriches it with the desired header by using the operation <code>addHeaders</code>. We apply it to the subsequent request definitions. Now, if we decided to use a query parameter to carry the API key instead of a request header, we would just change the body of the method <code>withApiKey</code>:</p>
<pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/endpoints4s/endpoints4s/tree/master/algebras/algebra/src/test/scala/endpoints4s/algebra/EndpointsDocs.scala#L135-L136" target="_blank" title="Go to snippet source">source</a><code class="language-scala">def withApiKey[A](request: Request[A]): Request[(A, String)] =
  request.addQueryString(qs[String](&quot;api_key&quot;))</code></pre>
<p>The following sections describe all the transformation operations that can be applied to requests, responses, and documentation.</p><div class="callout note "><div class="callout-title">Note</div>
<p>As shown, <code>withApiKey</code> is a method that takes a <code>Request[A]</code> and returns a <code>Request[(A, String)]</code> (the API key is modeled as a <code>String</code>). A drawback of this signature is that if we apply it to a <code>Request[Unit]</code> (ie, a request that carries no information), we get back a <code>Request[(Unit, String)]</code>, although a <code>Request[String]</code> would have been preferable (a tuple with an element of type <code>Unit</code> is useless). It is possible to fix this issue by using an implicit <code>Tupler</code>. See the corresponding <a href="../guides/tupler.html">documentation</a>.</p></div>
<h2><a href="#transforming-requests" name="transforming-requests" class="anchor"><span class="anchor-link"></span></a>Transforming Requests</h2>
<p>A request description can be enriched by adding headers or query parameters with the operations <code>addHeaders</code> and <code>addQueryString</code>, respectively. Both operations were showcased in the previous section.</p>
<p>As their names suggest, these operations can only add new headers or query parameters to a request, they can’t replace the existing constituents of a request.</p>
<h2><a href="#transforming-responses" name="transforming-responses" class="anchor"><span class="anchor-link"></span></a>Transforming Responses</h2>
<p>Responses can be enriched by using the <code>orElse</code> operation (already documented <a href="endpoints.html">here</a>), or by using the <code>addHeaders</code> operation, which is similar to the one defined on requests.</p>
<p>Like with requests, these operations can only enrich responses, they can’t replace their constituents.</p>
<h2><a href="#transforming-endpoints" name="transforming-endpoints" class="anchor"><span class="anchor-link"></span></a>Transforming Endpoints</h2>
<p>Complex transformations can be applied to a whole endpoint description by using the operations <code>mapRequest</code>, <code>mapResponse</code>, or <code>mapDocs</code>, as shown in the following example, which transforms an arbitrary endpoint description into an endpoint that is protected by HTTP basic authentication.</p>
<pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/endpoints4s/endpoints4s/tree/master/algebras/algebra/src/test/scala/endpoints4s/algebra/EndpointsDocs.scala#L141-L156" target="_blank" title="Go to snippet source">source</a><code class="language-scala">def withAuthentication[A, B](
    endpoint: Endpoint[A, B]
): Endpoint[(A, String), Either[String, B]] =
  endpoint
    .mapRequest { (endpointRequest: Request[A]) =&gt;
      endpointRequest.addHeaders(requestHeader(&quot;Authorization&quot;))
    }
    .mapResponse { (endpointResponse: Response[B]) =&gt;
      val unauthorizedResponse: Response[String] =
        response(
          Unauthorized,
          emptyResponse,
          headers = responseHeader(&quot;WWW-Authenticate&quot;)
        )
      unauthorizedResponse.orElse(endpointResponse)
    }</code></pre>
<p>The method <code>withAuthentication</code> takes any endpoint description, and enriches its request description to include the <code>Authorization</code> header, and its response description to include the <code>Unauthorized</code> response containing the <code>WWW-Authenticate</code> header.</p>
<p>Here is an example of usage of the method <code>withAuthentication</code>:</p>
<pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/endpoints4s/endpoints4s/tree/master/algebras/algebra/src/test/scala/endpoints4s/algebra/EndpointsDocs.scala#L160-L166" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val unauthenticatedEndpoint: Endpoint[Int, String] =
  endpoint(
    get(path / &quot;foo&quot; /? qs[Int](&quot;n&quot;)),
    ok(textResponse)
  )
val authenticatedEndpoint: Endpoint[(Int, String), Either[String, String]] =
  withAuthentication(unauthenticatedEndpoint)</code></pre>
<p>The endpoint <code>unauthenticatedEndpoint</code> has type <code>Endpoint[Int, String]</code>. Its request carries a value of type <code>Int</code> (passed as a query parameter), and its response carries a value of type <code>String</code> (provided by the response entity).</p>
<p>When we apply the method <code>withAuthentication</code> to the endpoint description, we get back an <code>Endpoint[(Int, String), Either[String, String]]</code>. It carries a pair of type <code>(Int, String)</code> in its request (the initial query parameter of type <code>Int</code>, and the credentials content of type <code>String</code>), and now its response has type <code>Either[String, String]</code> (it will be a <code>Left</code> with the content of the <code>WWW-Authenticate</code> header in case of incorrect credentials, or a <code>Right</code> if authentication succeeds).</p>
<p>The method <code>mapRequest</code> on the type <code>Endpoint[A, B]</code> takes as parameter a transformation function. This function turns the initial <code>Request[A]</code> into a <code>Request[C]</code> (for any type <code>C</code>). So, the resulting endpoint has type <code>Endpoint[C, B]</code>:</p>
<pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/endpoints4s/endpoints4s/tree/master/algebras/algebra/src/main/scala/endpoints4s/algebra/Endpoints.scala#L123" target="_blank" title="Go to snippet source">source</a><code class="language-scala">def mapRequest[C](func: Request[A] =&gt; Request[C]): Endpoint[C, B]</code></pre>
<p>The method <code>mapResponse</code> works similarly, but it takes as parameter a transformation function that turns the initial <code>Response[B]</code> into a <code>Response[C]</code> (for any type <code>C</code>).</p>
<p>Last, there is also a method <code>mapDocs</code>, which takes as parameter a function that transforms the initial <code>EndpointDocs</code> into another <code>EndpointDocs</code> value.</p>
</div>
<div>
<a href="https://github.com/endpoints4s/endpoints4s/tree/master/documentation/manual/src/main/paradox/algebras/middlewares.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
1.12.1
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../algebras/chunked-entities.html" title="Chunked Entities" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Chunked Entities
</span>
</div>
</a>
<a href="../algebras/assets.html" title="Assets" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Assets
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
<div class="md-footer-social">
<a href="https://github.com/endpoints4s/endpoints4s" class="md-footer-social__link fa fa-github"></a>
</div>

</div>
</div>
</footer>

</div>
<script src="../assets/javascripts/application.583bbe55.js"></script>
<script src="../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../."}})</script>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
</body>
</html>
